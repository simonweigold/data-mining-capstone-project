---
title: 'Data Mining using R: Capstone Project'
author: "Simon Weigold"
date: "`r Sys.Date()`"
output: html_document
fontsize: 12pt
#geometry: "left=3cm, right=3cm, top=3cm, bottom=3cm"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Introduction and theoretical framework
<style>
body {
text-align: justify}
</style>
Predicting the stock market has been of great interest for researchers and business professionals likewise (Source, Source). The opportunities that come with investing in listed companies have created not only fascination for private investors but also professional career paths and whole industries (Source). The way the stock market works is that companies in certain instances decide to “go public” (Source), i.e. the company offers shares for sale to the public, and anyone who would like to participate can buy these shares. With the availability of many shares from a wide range of different companies the stock market developed: a place, where investors buy and sell shares of publicly traded companies (Source). The dynamics on the stock market are driven by the fluctuations of prices of stocks which can depend on factors such as companies’ performances, industry trends and overall market conditions (Source).  
Since this dynamic establishes itself from an interchange between humans (executives at public companies, investors, financial advisors, just to name a few), communication can be expected to influence behaviours within this dynamic (Source). Mass communication in particular has a special role to play, as news channels such as newspapers, radio or television report on listed companies and thus create a certain image for the public's perception and opinion-forming (Source). News report on companies’ financial performances, changes in management, mergers and acquisitions and other relevant information that can affect the prices of stocks. It has been proven that investors form their perception of companies and stocks not only through metrics and balance sheets but also news publications. Ultimately, this influences the purchasing and selling behaviour of investors and therefore affects the stock price.  
To analyse the correlation between news and stock performance, researchers have often used the tool of sentiment analysis in previous research projects (Source, Source). Sentiment analysis is a technique which can be used to identify positive, neutral, or negative opinions within a given text (Source). Usually, the analysed text comes from news articles, social media posts or customer reviews (Source). To analyse sentiments in the context of stock performance, Twitter data has been studied for instance (Source). To understand the effect of more traditional types of mass media, it may also be useful to analyse news articles and/or their headlines. Thus, this research project aims to answer the following research question:  
*To what extent do the stock performance of the company Amazon and the sentiment of news headlines of articles about Amazon from The Guardian correlate?*  
Since previous empirical evidence demonstrates significant relationships between mass media sentiments and stock performance, the following hypothesis is established:  
*There is a correlation between the sentiment of news headlines of articles about Amazon from the Guardian and the stock performance of the company Amazon.*  

# Methodology
Before starting with the collection of data, all used packages are loaded now. Note, that to succesfully execute the Python code chunk, Python needs to be installed on the used device.
```{r}
library(tidyverse)
library(httr)
library(here)
library(rstudioapi)
library(lubridate)
library(guardianapi)
```
```{python}
import os
#nltk.download('vader_lexicon')
from nltk.sentiment.vader import SentimentIntensityAnalyzer
import pandas as pd
```

Once all packages have been loaded, the next step is the data collection. This research project analyses the stock data of Amazon and news headlines from The Guardian. First, the stock data is being retrieved.  

```{r}
# Claim API key for access to stock data
browseURL("https://www.alphavantage.co/support/#api-key")

# Set API key and request URL
api_key <- rstudioapi::askForPassword()
request_url <- str_c("https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=",
                     "AMZN",
                     "&outputsize=full&apikey=",
                     api_key)
```

```{r}
# Request data from API
amzn_get <- httr::GET(request_url)
amzn_content <- httr::content(amzn_get)
```

```{r}
# Extract data
close_data <- vector(mode = "list", length = length(amzn_content$`Time Series (Daily)`))
date <- vector(mode = "list", length = length(amzn_content$`Time Series (Daily)`))
for (i in 1:length(close_data)) {
  close_data[i] <- amzn_content$`Time Series (Daily)`[[i]]$`4. close`
  date[i] <- names(amzn_content$`Time Series (Daily)`[i])
}

# Convert to data frame
matrix <- matrix(nrow = length(date), ncol = 2, byrow = T)
for (j in 1:length(date)) {
  matrix[j,] <- c(date[[j]],
                  close_data[[j]])
}
amzn <- as.data.frame(matrix)

# Enhance data frame
colnames(amzn) <- c("date", "close_data")
amzn$date <- as.Date(amzn$date)
amzn$close_data <- as.integer(amzn$close_data)

# Save as csv
write.csv(amzn, here::here("amzn.csv"))
```


- Sentiment Analysis using Vader
- Correlation metric

# Results and Conclusion

- What can we learn from this analysis?

# Literature

```{r word_count, echo=FALSE, results='asis'}
# Read the RMarkdown file
rmd_file <- "Report.Rmd"
rmd_content <- readLines(rmd_file)
# Function to check if a line is a code chunk
is_code_chunk <- function(line) {
  grepl("```\\{r.*\\}", line) || grepl("^````", line)
}
# Extract text without code chunks
chunk_tags <- map_lgl(rmd_content, is_code_chunk)
in_chunk <- cumsum(chunk_tags) %% 2 == 1
rmd_no_code_chunks <- rmd_content[!in_chunk & !chunk_tags]
# Count words
word_count <- sum(str_count(rmd_no_code_chunks, "\\S+"))
cat(paste0("Anzahl Wörter: ", word_count))
```